<div 
  id="scroll-video-wrapper-{{ section.id }}" 
  class="scroll-video-wrapper"
  style="height: {{ section.settings.section_height }}vh;"
>
  <img 
    id="scroll-seq-{{ section.id }}" 
    class="scroll-video"
    alt=""
  >
</div>

<style>
/* ------- Desktop ------- */
.scroll-video-wrapper {
  position: relative;
}

.scroll-video {
  position: sticky;
  top: 0;
  width: 100%;
  height: 100vh;
  object-fit: cover;
}

/* ------- Mobile ------- */
@media (max-width: 767px) {
  .scroll-video-wrapper {
    height: 120vh;
  }

  .scroll-video {
    height: 100vh;
    width: 100vw;
    object-fit: cover;
    position: sticky;
    top: 0;
  }

  .scroll-video-wrapper + * {
    margin-top: 0 !important;
  }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* -----------------------------------------------------
     1) Définis ici les URLs Shopify de tes frames uploadées
     ----------------------------------------------------- */
  const frameURL = (i) => {
    const files = {
      1: "URL_SHOPIFY_DE_frame_0001.png",
      2: "URL_SHOPIFY_DE_frame_0002.png",
      3: "URL_SHOPIFY_DE_frame_0003.png",
      4: "URL_SHOPIFY_DE_frame_0004.png",
      5: "URL_SHOPIFY_DE_frame_0005.png"
    };
    return files[i];
  };

  /* -----------------------------------------------------
     2) Setup de la séquence d’images
     ----------------------------------------------------- */
  const frameCount = 5; // mets ici ton nombre total de frames
  const img = document.getElementById("scroll-seq-{{ section.id }}");
  const wrapper = document.getElementById("scroll-video-wrapper-{{ section.id }}");

  // Première image
  img.src = frameURL(1);

  function getScrollMax() {
    return wrapper.offsetHeight - window.innerHeight;
  }

  let scrollMax = getScrollMax();
  window.addEventListener("resize", () => {
    scrollMax = getScrollMax();
  });

  /* -----------------------------------------------------
     3) Animation scroll → change la frame affichée
     ----------------------------------------------------- */
  let last = 0;
  const fps = 30;
  const interval = 1000 / fps;

  function updateFrame() {
    scrollMax = getScrollMax();
    if (scrollMax <= 0) return;

    const progress = Math.min(Math.max(window.scrollY / scrollMax, 0), 1);
    const index = Math.min(frameCount, Math.ceil(progress * frameCount));

    img.src = frameURL(index);
  }

  window.addEventListener("scroll", () => {
    const now = performance.now();
    if (now - last < interval) return;
    last = now;
    requestAnimationFrame(updateFrame);
  });

});
</script>

{% schema %}
{
  "name": "Scroll Sequence",
  "settings": [
    {
      "type": "range",
      "id": "section_height",
      "label": "Hauteur desktop (vh)",
      "min": 100,
      "max": 500,
      "step": 10,
      "default": 200
    }
  ],
  "presets": [
    {
      "name": "Scroll Sequence"
    }
  ]
}
{% endschema %}
